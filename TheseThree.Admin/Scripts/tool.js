/**
 * Created by ecloud_0317 on 16/4/27.
 */
function init_btn_group(e){var t={};(e&&e.find(".btngroup")||$(".btngroup")).each(function(){var e=$(this);e.removeClass("btngroup");var t=e.find("ul.dropdown-menu");if(t.length>0)return;var n=e.attr("name")||"操作",r=e.find("span,a");e.empty();var i=e.parent().find(this.nodeName).length/2,s=e.attr("pr")==1||i<e.parent().find(this.nodeName).index(this);if(this.nodeName=="TD"||this.nodeName=="TH")e=$('<div class="btn-group"></div>').appendTo(this);var o=$('<a href="#" class="dropdown-toggle" data-toggle="dropdown"></a>').html(n+'<span class="caret"></span>').appendTo(e);this.nodeName!="LI"&&o.addClass("btn"),t=$('<ul class="dropdown-menu"></ul>').appendTo(e),s&&t.addClass("pull-right"),r.each(function(){var e=$("<li></li>").appendTo(t);$(this).removeClass("btn").appendTo(e)})})}function initDomForTimeInput(e){(e&&e.find(".time_inputer")||$("form .time_inputer")).attr("readonly",!0).each(function(){var e=$(this),t=e.parents(".form-wrapper:eq(0)");if(t.length>0){var n=t.find(".input-group");n.length<1&&(n=$('<div class="input-group"></div>').insertAfter(e));var r=n.find(".input-group-addon");r.length<1&&(r=$('<span class="input-group-addon"></span>'),n.children().length>0?r.insertBefore(n.children().first()):r.appendTo(n)),$('<i class="glyphicon glyphicon-time"></i>').appendTo(r),e.insertAfter(r),n.find(".glyphicon-time").click(function(){$(this).parents(".input-group:eq(0)").find("input").focus()})}else $("<i class=icon-time></i>").css("margin-bottom","10px").click(function(){$(this).prev("input").focus()}).insertAfter(this)}).datetimepicker({lang:"zh",formatDate:"Y-m-d",step:window.time_inputer_step||5})}function initMultiSel(e){function t(){var e=$(this),t=[];if(!e.attr("data_url"))return;e.find("option:selected").each(function(){t.push({id:this.value,text:this.text})}),e.find("option").remove(),reset_select_input(e,e.attr("data_url"),t,this.multiple)}e?$(e).find("select[data_url]").each(t):$("select[data_url]").each(t)}function initAttachmentUploader(){var e="filter,single_file,target_dir,chunk_size,max_file_size,min_width,min_height,max_width,max_height,min_rate,max_rate".split(","),t="before_upload,add,file_uploaded,upload_complete,upload_progress".split(",");$('input[data_model="attachment"]').each(function(){var n=$(this),r=n.parents(".control-group,.form-group").first(),i=r.attr("id"),s={single_file:1};r.find(".controls,.form-wrapper").first().addClass("item-list"),r.removeClass("hidden"),n.attr("rel_input")||n.attr("rel_input","file_name");var o=n.attr("item_code")||"";e.map(function(e){var t=n.attr(e);t&&(s[e]=t,n.removeAttr(e))}),t.map(function(e){var t=n.attr(e);if(!t)return;n.removeAttr(e);var r=ucfirst(t,"onUp");e=ucfirst(e),window[r]&&typeof r=="function"&&(s[e]=window[r])}),s.browse_bnt_id="bnt_"+i,o||(s.filter=="image"?(o="",n.attr("width")&&(o+="width:"+n.attr("width")+";",n.removeAttr("width")),n.attr("height")&&(o+="height:"+n.attr("height")+";",n.removeAttr("height")),o&&(o=' style="'+o+'"'),o='<span class="img_show"'+o+'><a href="#" class="item-del f-r">删除</a></span>'):o='<span rel_item="file_name"></span><a href="#" class="item-del f-r">删除</a>');var u=$("<div></div>").html(o).appendTo(r),a=n.clone().val("").removeAttr("id").removeAttr("data_model");a.appendTo(u),a.clone().insertBefore(n),this.value&&(s.datas=[{file_name:this.value}]),u.addClass("item-template");var f=$('<a href="#">上传</a>').insertAfter(this).attr({id:s.browse_bnt_id});n.remove(),attatchUploader(r,s)})}function ucfirst(e,t){return(t||"")+e.split("_").map(function(e){return e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase()}).join("")}function cancelEvt(e){e.returnValue=!1,e.preventDefault()}function initTemplateFields(e){function n(e,t){var n,i=$(this),s=i.parents("fieldset:eq(0)");e=e||s.attr("name");var o=e?'fieldset[name="'+e+'"]':"fieldset[name]",u=i,a=3;while(a-->0){n=u.next(o);if(n.length>0)break;n=u.parent(o);if(n.length>0)break;u=u.parent()}if(n.length<1)return;return r.call(this,n.attr("name"),n,null,t)}function r(e,n,i,s){if(!t[e])return null;var o=t[e].clone().appendTo(n||'fieldset[name="'+e+'"]');o.addClass("tpl_entity");var u=ucfirst(e,"init");return i&&typeof i=="object"&&(o.find("select,input,textarea,[column-name]").each(function(){var e=!1,t=$(this),n=this.name||(e=!0,t.attr("column-name")),r=i[n];if(typeof r=="undefined")return;this.type=="radio"||this.type=="checkbox"?this.value==r&&(this.checked=!0):e?t.html(r):t.val(r)}),o.find("fieldset[name]").each(function(){var e=$(this),t=e.attr("name"),n=i[t];if(!n)return;n instanceof Array?n.map(function(n){r(t,e,n)}):r(t,$(this),i)})),window[u]&&window[u].call(this,o,i,s),o}window.createTplEntity=r,window.__tpls||(window.__tpls={},$(document).bind("mthd_onCreateByTpl",function(e,t){n.apply(e.target,t.args)}));var t=window.__tpls;e=e||"field_tpl",selector="."+e,$(selector).each(function(){var n=$(this),r=n.attr("name")||n.parents("fieldset:eq(0)").attr("name");t[r]=n.clone().removeClass(e),t[r].find(selector).remove(),n.remove()})}function showPopTip(e,t,n){function h(e){return e.hasClass("pop-tip")?!0:e.parents(".pop-tip").length>0?!0:!1}function p(e){cancelEvt(e);var t=$(e.target);if(callFunction.call(e.target,n.onClick,e,u)===!1)return;d.call(this)}function d(t){l||(l=!0,getDlgBg("close"));if(!u)return;r&&(clearTimeout(r),r=0);if(callFunction.call(u.get(0),n.onBeforeClose,t,u)===!1)return;$(document).unbind("click.for_pop_tip"),u.remove(),u=null,$("select").css("visibility:visible"),callFunction.call(e,n.onClose,t)}var r=0;e instanceof window.jQuery&&(e=e.get(0));if(!e)return;$(".pop-tip.auto_close").each(function(){$(this).trigger("close")}),typeof t!="object"&&(t='<div class="body">'+t+"</div>"),n=$.extend({skip:""},n);var i=$(n.parent||document.body).get(0)||document.body,s=getRect(e),o=getRect(i),u=$('<div class="mop_tip pop-tip"><div class="pop-tip-bg"></div></div>').appendTo(i),a={width:n.width||s.width-2};a.width<100&&delete a.width;var f="",l=!1;n.attr&&u.attr(n.attr),n.cla&&u.addClass(n.cla),n.style&&u.attr("style",n.style),n.css&&u.css(n.css),u.css("position")=="fixed"&&(s.left-=document.body.scrollLeft,s.top-=document.body.scrollTop);var c=getRect(u);return s.height2=Math.max(s.height,c.height),s.width2=Math.max(s.width,c.width),o.width<s.left+s.width2+50?(a.right=o.width-s.left-s.width+"px",f="pop_r"):(a.left=s.left+"px",f="pop_l"),o.height<s.top+s.height2?(a.bottom=o.height-s.top+"px",f+="_b"):(a.top=s.top+s.height+"px",f+="_t"),n.autoClose!==!1&&(f+=" auto_close"),u.addClass(f),callFunction.call(e,n.onBeforeShow,u,a),u.hide(),u.get(0).popClose=u,u.css(a),$(t).appendTo(u),n.show_bg&&getDlgBg("show",function(){l=!0,d()}),u.show(),$("select").css("visibility:hidden"),callFunction.call(e,n.onShow,u),n.has_close&&$('<a href="#" class="bnt_close_pop_tip">x</a>').appendTo(u),n.autoClose!==!1&&$(document).bind("click.for_pop_tip",function(e){if(!u)return;var t=$(e.target);if(callFunction.call(e.target,n.onClick,e,u)===!1)return;var r=n.skip&&n.skip.indexOf(e.target.nodeName)>=0;if(!r&&h.call(e.target,t))if(!t.attr("skip")||t.attr("skip").toUpperCase().split(",").indexOf(e.target.nodeName)==-1)return;d.call(this)}),u.on("close",p),u.find(".bnt_close_pop_tip").click(p),n.timeout&&n.timeout>0&&(r=setTimeout(function(){d()},n.timeout)),u}function getDlgBg(e,t){var n=$(".dialog_bg");if(n.length<1){var r=[];n=$('<div class="dialog_bg"></div>').appendTo(document.body).hide(),n.data({info:{n:0},cb:r}),n.click(function(){var e=r[r.length-1];typeof e=="function"?e.call(n.get(0))!==!1&&getDlgBg("close"):e=="close"&&getDlgBg("close")})}if(e){var i=n.data("info"),r=n.data("cb");if(e=="show")i.n++,n.show(),r.push(t||"");else if(e=="close")i.n--,r.pop(),i.n<1&&(i.n=0,n.hide());else if(e=="close_all"){i.n=0,n.hide();while(r.length>0)r.pop()}}return n.close=function(){var e=n.data("info");e.n--,e.n<1&&(e.n=0,n.hide())},n}function getRect(e){var t=$(e),n=t.offset();e=t.get(0);var r={left:0,top:0,width:t.outerWidth(),height:t.outerHeight()};return r.left=n.left,r.top=n.top,r}function showTipsDefault(e){var t=$(this),n,n=t.data("pop");n&&(n.remove(),t.removeData("pop"),t.unbind("remove.show_tip"));if(e.type=="mouseout"){t.removeClass("hover");return}t.unbind("remove.show_tip"),t.bind("remove",function(){var e=t.data("pop");e&&(e.remove(),t.removeData("pop"))}),t.addClass("hover");var r="",i=t.attr("text-sel");i&&$(i).length>0?r=$(i).html():r=t.attr("tips")||t.attr("title");if(!r)return;var s={autoClose:!1};t.attr("tip-btn")&&(s.has_close=!0),t.attr("tip-cla")&&(s.cla=t.attr("tip-cla")),n=showPopTip(this,r,s),t.data("pop",n)}function ajax(e,t,n,r,i,s){function a(){return s&&typeof s!="function"&&(s=null),$.ajax(i).success(function(e){s&&s.call(o,e)}).fail(function(e,t,n){var i=e.responseText||"";if(r=="JSON")try{i=JSON.parse(i)}catch(u){i=null}else i.indexOf("<html")!=-1&&(i="");s&&s.call(o,i,n)})}var o=this;typeof i=="function"?(s=i,i={}):typeof r=="function"?(s=r,r=i=""):typeof n=="function"?(s=n,n=r=i=""):typeof t=="function"&&(s=t,t={},n=r=i=""),typeof n=="object"?(i=r,r=""):typeof n=="object"&&(i=n,r=n=""),i=$.extend({dataType:"html",method:"GET"},i),n&&(i.type=n),r&&(r=r.toUpperCase(),i.dataType=r),t&&(i.data=t),i.url=e;var u=a();return{set:function(e,t){i[e]=t},xhr:function(){return u}}}function getFormData(e,t){return t=t||{},typeof t!="object"&&(t={}),$(e).find("input,select,textarea").each(function(){if(!this.name)return;var e=this.name,n=$(this);this.nodeName=="SELECT"?n.find("option:selected").each(function(){setObjVal(t,e,this.value)}):(this.nodeName=this.type=="radio"||this.type=="checkbox")?this.checked&&setObjVal(t,e,this.value):setObjVal(t,e,this.value)}),t}function getObjVal(e,t,n){typeof n=="undefined"&&(n=null);var r=e,i,s,o,u=t.replace(/\]/g,"").split(/[\[\.]/g).map(function(e){return trim(e)});while(u.length>1){i=u.shift(),o=r instanceof Array;if(i===""){if(!o||r.length<1||typeof r[0]!="object")return n;r=r[0];continue}if(typeof r[i]!="object")return n;r=r[i]}return i=u.shift(),r instanceof Array?r[0]:r[i]}function setObjVal(e,t,n){function a(e,t){for(var n=0,r,i;n<t.length;n++){r=t[n],i=typeof e[r];if(i=="undefined")return!0;if(i!="object")return!1;if(e[r]instanceof Array)return!0;e=e[r]}return!1}var r=e,i,s,o,u=t.replace(/\]/g,"").split(/[\[\.]/g).map(function(e){return trim(e)});while(u.length>1){i=u.shift(),o=r instanceof Array;if(!i){if(!o)throw"表单信息错误!";i=u[0],r.length>0?s=r[r.length-1]:(s={},r.push(s)),a(s,u)||(s={},r.push(s)),r=s;continue}typeof r[i]!="object"&&(u.length>0&&!u[0]?r[i]=[]:r[i]={}),r=r[i],r||console.error(i,u,n)}if(r instanceof Array)r.push(n);else{if(u.length!=1)throw"表单信息错误!";i=u.shift(),r[i]=n}}function trim(e,t,n){var r;return t=t||"\\s",n=="r"?r=new RegExp("["+t+"]+$","g"):n=="l"?r=new RegExp("^["+t+"]+","g"):r=new RegExp("^["+t+"]+|["+t+"]+$","g"),e.replace(r,"")}function createTab(e){function f(e,t){var n=$("<div></div>").appendTo(t);return typeof e=="object"?$(e).appendTo(n):n.html(e),n}function l(e){cancelEvt(e),c(r.find(">div").index(this))}function c(e,n){var s=u.find(">div"),o=r.find(".on");if(o.length>0){var f=s.index(o);if(e==o)return}t=e,o.removeClass("on"),$(r.find(">div").get(e)).addClass("on"),n?a.css({left:-i*e+"px"}):a.animate({left:-i*e}),h()}function h(){s=300,t>=0&&(s=u.find(".tab-item:eq("+t+")").outerHeight()),u.css("height",s+"px")}var t=-1,n=$('<div class="tab-block"><div class="tab-bar"></div><div class="tab-body"><div></div></div>');e&&n.appendTo(e),n.on("click",".tab-bar>div",l);var r=n.find(".tab-bar"),i=$(e).width(),s=0,o=0,u=n.find(".tab-body").css({position:"relative",width:i+"px"});u.bind("loaded",function(e){h()});var a=u.find(">div").css({position:"absolute",top:"0px"});return n.addItem=function(e,t){var n=f(e,r),u=f(t,a).addClass("tab-item").css({width:i+"px",position:"absolute",top:"0px",left:i*o+"px"});return s=Math.max(s,u.outerHeight()),o++,a.css("width",i*o+"px"),o==1&&c(0,!0),this},n.showItem=function(e,t){return c(e||0,t),this},n}function bindJQLoadingEvent(){if($.bind_loading_evt)return;$.bind_loading_evt=!0;var e=$.fn.html,t=$.fn.domManip;$.fn.html=function(){var t=e.apply(this,arguments);return t&&t.constructor==$&&t.trigger("loaded"),t},$.fn.domManip=function(){var e=[].slice.call(arguments,0),n=e.pop();return typeof n!="function"&&(e.push(n),n=null),e.push(function(e){n&&n.apply(this,arguments),$(e).trigger("loaded",!0)}),t.apply(this,e)}}function showSliderLayer(e){function s(){var i=$(e.target);e.dir=="r2l"?(n.width="0px",n.height=e.height||"100%",n.right="0px",n.top="0px",r.width=i.innerWidth()):e.dir=="l2r"&&(n.width="0px",n.height=e.height||"100%"),t.css(n).hide().children().hide();if(a(e.onCreate,n,r)===!1)return;t.show().animate(r,o)}function o(){var n=t.find(".body"),r=t.innerHeight()-t.find(".header").outerHeight()-n.outerHeight()+n.innerHeight()-20,i=t.innerWidth()-n.outerWidth()+n.innerWidth()-20;n.css({width:i+"px",height:r+"px",overflow:"auto"}).html(e.html||""),t.find(".header h5").html(e.title||""),t.children().show(),a(e.onShow),t.find(".bnt_close").click(u)}function u(e){e.preventDefault(),e.returnValue=!1,f()}function a(n){var r=[].slice.call(arguments,1);r.unshift(e);if(n&&typeof n=="function")return n.apply(t.get(0),r)}function f(n){for(var i in r)r[i]=0;var s=[].slice.call(arguments,0);s.unshift(e.onBeforeClose),s.push(r);if(a.apply(null,s)===!1)return;t.show().animate(r,function(){if(a(e.onClose,n)===!1)return;t.remove()})}e=$.extend({dir:"r2l",target:document.body},e);var t=$('<div class="layer-slider"><div class="header"><h5></h5><a href=" " class="bnt_close">X</a ></div><div class="body"></div></div>');t.appendTo(e.target),e.appendClass&&t.addClass(e.appendClass);var n={},r={};setTimeout(s,1);var i={close:f,layer:t};return i.appendTo=function(e){return t.appendTo(e),this},i.find=function(e){return t.find(e)},i.on=function(e,n,r){return t.on(n,e,function(e){cancelEvt(e);var n;if(r&&(n=r.call(this,e,t.get(0))===!1))return;f(n)}),this},"create,show,before_close,close,close".split(",").map(function(t){var n=t.split("_").map(function(e,t){return ucfirst(e)}).join("");i["set"+n]=function(t){return typeof t=="function"&&(e["on"+ucfirst(n)]=t),this}}),"title,html".split(",").map(function(t){i[t]=function(n){return e[t]=n,this}}),i}function dlgConfirm(e,t,n){confirm(e)?t&&typeof t=="function"&&t.call(this,!0):n&&typeof n=="function"&&n.call(this,!1)}function resetHeight(e){return $(e).each(function(){var e=$(this);e.css("height",this.scrollHeight+"px")})}function showTipsMenu(e){showTipsDefault.call(this,e);var t=$(this),n=t.find(".pop_menu");n.css({right:"auto",left:-n.outerWidth()+"px",top:"0px"})}function onAjaxRequest(e){function a(){t.data("loading",1),ajax(u,o,t.attr("method")||"get",t.attr("dtype")||"html",function(e,n){t.removeData("loading");if(i&&i.call(t.get(0),e,n)===!1)return;s&&(s=$(s),s.length>0&&s.html(e))})}var t=$(this),n=t.attr("ajax"),r=t.attr("ask")||n,i=t.attr("cb")||n,s=t.attr("target");if(t.data("loading"))return!1;var o={};this.nodeName=="FORM"&&(o=getFormData(this)),o._method&&delete o._method;var u=o.url||this.href||t.attr("action");i&&(i=ucfirst(i,"res"),window[i]?i=window[i]:i=null);if(r){r=ucfirst(r,"ask");if(window[r]){if(window[r].call(this,o,a)===!1)return;cancelEvt(e);return}}cancelEvt(e),a()}function onSelectAll(){var e=$(this),t=e.attr("sel-selecor")||e.parent().attr("sel-selecor")||e.parents(".sel_bar:eq(0)").attr("sel-selecor"),n=!!e.attr("send_evt");if(!t)return;var r=!0;this.type=="checkbox"&&(r=this.checked),$(t).each(function(){this.nodeName=="INPUT"?(this.checked=r,n&&$(this).change()):this.nodeName=="OPTION"?(this.selected=r,n&&$(this).change()):r?$(this).addClass("sel"):$(this).removeClass("sel")}),e.parents(".sel_bar:eq(0)").find("input:checkbox").attr("checked",!1),this.checked=r}function onSelectXor(){var e=$(this),t=e.attr("sel-selecor")||e.parent().attr("sel-selecor")||e.parents(".sel_bar:eq(0)").attr("sel-selecor"),n=!!e.attr("send_evt");if(!t)return;$(t).each(function(){this.nodeName=="INPUT"?(this.checked=!this.checked,n&&$(this).change()):this.nodeName=="OPTION"?(this.selected=!this.selected,n&&$(this).change()):$(this).hasClass("sel")?$(this).removeClass("sel"):$(this).addClass("sel")}),e.parents(".sel_bar:eq(0)").find("input:checkbox").attr("checked",!1),this.checked=!0}function onSelectNo(){var e=$(this),t=e.attr("sel-selecor")||e.parent().attr("sel-selecor")||e.parents(".sel_bar:eq(0)").attr("sel-selecor"),n=!!e.attr("send_evt");if(!t)return;$(t).each(function(){this.nodeName=="INPUT"?(this.checked=!1,n&&$(this).change()):this.nodeName=="OPTION"?(this.selected=!1,n&&$(this).change()):$(this).hasClass("sel")&&$(this).removeClass("sel")}),e.parents(".sel_bar:eq(0)").find("input:checkbox").attr("checked",!1)}function Dlg(e,t){function r(e){if(!e||typeof e!="function")return;var t=[].slice.call(arguments,1),r=this;return this==window?r=n.get(0):t.unshift(n.get(0)),e.apply(r,t)}function i(e,t){for(var n in t)e.find(n).click(o(t[n]))}function s(e,n){n.map(function(n,r){var i=$('<a href="#"></a>').appendTo(e);typeof n=="string"&&(n={name:n}),i.html(n.name||"BUTTON"+r),t.fbnt_cla&&i.addClass(t.fbnt_cla),n.cla&&i.addClass(n.cla),i.click(o(n.func))})}function o(e){var t=null;return typeof e!="function"&&(t=e,e=null),function(r){cancelEvt(r);var i=t;e&&(i=e.call(this,n)),i!==!1&&f(i)}}function u(){if(n.css("display")=="none"){if(r(t.show)===!1)return;var e=null;t.bg_click&&(typeof t.bg_click=="function"?e=t.bg_click:e=function(){return f(t.bg_click)});var i=getDlgBg("show",e);i.insertAfter(n),n.show(),n.resize()}}function a(){var e=getDlgBg(),t=e.outerWidth(),r=e.outerHeight(),i=n.outerWidth(),s=n.outerHeight();if(s+n.offset().top+20-document.body.scrollTop>r){n.css({"margin-top":"0px",top:"10%",bottom:"10%"});var o=0;n.find(".dialog-header,.dialog-footer").each(function(){o+=$(this).outerHeight()}),n.find(".dialog-body").css({height:n.height()-o+"px",overflow:"auto"})}}function f(e){if(r(t.close,e)===!1)return!1;getDlgBg("close"),n.remove()}function l(e){var n=$("#dlg_"+e);if(n.length>0)return n.find(".dialog-footer,.dialog-body").empty(),n.find(".btn_dlg_close").remove(),n;var r="<div>";r+='<div class="dialog-content">',r+='<div class="dialog-header"></div>',r+='<div class="dialog-body"></div>',r+='<div class="dialog-footer"></div>',r+="</div>",r+="</div>";var i="";i+='<h4 class="dialog-title">移动</h4>';var s="",n=$(r);return n.find(".dialog-header").html(i),n.find(".dialog-footer").css({"text-align":"center"}),n.addClass("dialog").attr("id","dlg_"+t.id).appendTo(document.body).hide(),n.find(".close").click(function(e){cancelEvt(e),f()}),n.on("resize",a),n}t=$.extend({id:"dlg_default",fbnt_cla:""},window.dlg_config,t);var n=l(t.id);return n.close=f,n.find(".dialog-body").html(e||""),setTimeout(function(){if(t.status=="close")f();else if(t.status=="hide")f();else{var e=0;t.bnts&&t.bnts instanceof Array&&(s(n.find(".dialog-footer"),t.bnts),e++),t.bind&&typeof t.bind=="object"&&(i(n.find(".dialog-body"),t.bind),e++),n.find(".dialog-title").html(t.title||"");if(t.has_close_btn==1||e===0&&t.has_close_btn!==!0){var r=n.find(".dialog-header");$('<a href="#" class="btn_dlg_close">关闭</a>').appendTo(r),i(r,{".btn_dlg_close":1})}u()}},1),n.setOpt=function(e,n){return t[e]=n,this},n.setBtn=function(e,t,r){return s(n.find(".dialog-footer"),[{name:e,func:t,cla:r}]),this},n}function Dlg22(e,t){function r(e){if(!e||typeof e!="function")return;var t=[].slice.call(arguments,1),r=this;return this==window?r=n.get(0):t.unshift(n.get(0)),e.apply(r,t)}function i(e,t){for(var n in t)e.find(n).click(o(null,t[n]))}function s(e,n){n.map(function(n,r){var i=$('<a href="#"></a>').appendTo(e);typeof n=="string"&&(n={name:n}),i.html(n.name||"BUTTON"+r),t.fbnt_cla&&i.addClass(t.fbnt_cla),n.cla&&i.addClass(n.cla),i.click(o(i,n.func))})}function o(e,t){return typeof t!="function"&&(t=null),function(e){cancelEvt(e);var r=null;t&&(r=t.call(this,n)),r!==!1&&u(r)}}function u(e){if(r(t.close,e)===!1)return;n.data("modal").hide()}function a(e){var n=$("#dlg_"+e);if(n.length>0)return n.find(".modal-footer,.modal-body").empty(),n;var r='<div role="dialog" aria-labelledby="muti_copy_modalLabel" aria-hidden="true">';r+='<div class="modal-dialog">',r+='<div class="modal-content">',r+='<div class="modal-header"></div>',r+='<div class="modal-body"></div>',r+='<div class="modal-footer"></div>',r+="</div>",r+="</div>",r+="</div>";var i="";i+='<button type="button" class="close" data-dismiss="modal">',i+='<span aria-hidden="true">&times;</span>',i+='<span class="sr-only">关闭</span>',i+="</button>",i+='<h4 class="modal-title">移动</h4>',i+="";var s="",n=$(r);return n.find(".modal-header").html(i),n.find(".modal-footer").css({"text-align":"center"}),n.addClass("modal fade").attr("id","dlg_"+t.id).appendTo(document.body),n}t=$.extend({id:"dlg_default",fbnt_cla:""},window.dlg_config,t);var n=a(t.id);return n.close=u,n.find(".modal-body").html(e||""),n.find(".modal-footer").empty(),setTimeout(function(){t.bnts&&t.bnts instanceof Array&&s(n.find(".modal-footer"),t.bnts),t.bind&&typeof t.bind=="object"&&i(n.find(".modal-body"),t.bind),n.find(".modal-title").html(t.title||"");if(r(t.show)===!1)return;n.modal(t.status)},1),n.setOpt=function(e,n){return t[e]=n,this},n.setBtn=function(e,t,r){return s(n.find(".modal-footer"),[{name:e,func:t,cla:r}]),this},n}function DlgOk(e,t,n){return typeof t=="function"&&(n=t,t=""),Dlg(e,{title:t||"",id:"dlg_confirm",bnts:[{name:"确定",func:n}]})}function DlgWaitting(e,t,n){e&&e!="close"&&e!="hide"&&e!="show"&&(n=t,t=e,e=null);var r='<div style="text-align: center;">';return r+='<i class="fa fa-spinner fa-pulse fa-4x"></i><br>',r+=t||"拼命加载中…",r+="</div>",e=="close"&&(e="hide"),Dlg(r,{title:n||"状态",id:"dlg_waitting",status:e,bind:{"i.fa-spinner":1}})}function DlgYesOrNo(e,t,n,r){return typeof t=="function"&&(r=n,n=t,t=""),Dlg(e,{title:t||"",id:"dlg_yes_or_no",bnts:[{name:"确定",func:n||function(){}},{name:"取消",func:r}]})}function select_bind(e,t){$(document).on("click",e,function(e){if(t&&t.call(this,e)===!1)return;this.nodeType=="input"?this.checked==!this.checked:this.nodeType=="OPTION"?this.selected=!this.selected:$(this).hasClass("sel")?$(this).removeClass("sel"):$(this).addClass("sel")})}function QiniuVideoExt(e){var t={};e.prototype.avInfo=function(e){var t=this.avFullInfo(e);if(!t)return t;var n={duration:t.format.duration,bit_rate:t.format.bit_rate,type:""};if(this.isVideo(e)){n.type="video";for(var r=0,i;r<t.streams.length;r++){i=t.streams[r];if(i.codec_type=="video"){n.height=i.coded_height,n.width=i.coded_width;break}}}else this.isVideo(e)&&(n.type="audio");return n},e.prototype.isVideo=function(e){var t=this.avFullInfo(e);if(!t)return!1;for(var n=0;n<t.streams.length;n++)if(t.streams[n].codec_type=="video")return!0;return!1},e.prototype.isAudio=function(e){var t=this.avFullInfo(e);if(!t)return!1;for(var n=0;n<t.streams.length;n++)if(t.streams[n].codec_type=="audio")return!0;return!1},e.prototype.avFullInfo=function(e){if(typeof t[e]!="undefined")return t[e];var n=this.getUrl(e)+"?avinfo",r=this,i=Qiniu.createAjax(),s=null;return i.open("GET",n,!1),i.onreadystatechange=function(){i.readyState===4&&i.status===200&&(s=r.parseJSON(i.responseText))},i.send(),t[e]=s,s}}function avInfo(e){if(!window.Qiniu)throw Error("Qiniu SDK invalid !");return Qiniu.isVideo||QiniuVideoExt(Qiniu.constructor),Qiniu.avInfo(e)}function attatchUploader(e,t){function f(){t.filter=="image"?(t.mineTypes="image/*",t.filter="*"):t.filter=="audio"?t.filter="*.mp3;*.wav":t.filter=="video"&&(t.mineTypes="video/*",t.filter="*"),t.mineTypes&&(t.mineTypes instanceof Array||(typeof t.mineTypes=="string"?t.mineTypes=t.mineTypes.split(";"):t.mineTypes="")),t.filter&&(t.filter instanceof Array||(t.filter=="*"?t.filter="":typeof t.filter=="string"?t.filter=t.filter.split(";"):t.filter=""));var s=o.attr("data-blueprint-id"),u=o.attr("data-association");if(s){var a=$("#"+s);r=a.attr("data-blueprint"),i="new_"+u+"",a.remove(),o.removeClass("add_nested_fields"),o.appendTo(e)}else r=e.find(".item-template").clone().removeClass("item-template"),e.find(".item-template").remove();n=e.find(".item-list").length>0?e.find(".item-list"):e,$("#"+t.container).length<1&&$("<div></div>").attr("id",t.container).css({width:"0px",height:"0px"}).appendTo(e);if(t.datas)while(t.datas.length>0)d(t.datas.shift()).addClass("up-st-finish")}function l(e,t){var n=e.find(".progress"),r=n.children().first();n.hasClass("progress-v")?r.css({height:t+"%"}):r.css({width:t+"%"}),e.find(".progress_status").text(t+"%"),n.show()}function c(e,t){return e?(t=t.toLowerCase(),e.indexOf(t)>=0?!0:(t=t.split("/").shift()+"/*",e.indexOf(t)>=0)):!1}function h(e,t){return e?(t=t.toLowerCase(),t="*."+t,e.indexOf(t)>=0):!1}function p(e,n){var r=function(){a.removeFile(n.id),n.destroy();var e="不支持的格式文件上传!<br>只支持一下类型的文件上传:";t.mineTypes&&(e+="<br>&nbsp;&nbsp;"+t.mineTypes.join("; ")),t.filter&&(e+="<br>&nbsp;&nbsp;"+t.filter.join("; ")),DlgOk(e,"文件格式不合法")};if(!c(t.mineTypes,n.type)&&!h(t.filter,n.name.split(".").pop()))if(!!t.filter||!!t.mineTypes)return r();var i=n.size,s="";i>1024&&(i/=1024,s="k"),i>1024&&(i/=1024,s="M"),i>1024&&(i/=1024,s="G"),i=(i*100|0)/100,n.ksize=i,n.my_st=1,n.item=d({real_name:n.name})}function d(e){e.id||(e.id=t.browse_bnt_id+"_"+u++);var s=null;return typeof r=="string"?s=$(r.replace(new RegExp(i,"g"),e.id)):(s=r.clone(),s.find("[name]").each(function(){this.name=this.name.replace("["+i+"]","["+e.id+"]")})),s.attr("id",e.id).addClass("item_entity").appendTo(n),s.find(".item-del").length<1&&$('<a href="#" class="item-del">删除</a>').appendTo(s),v(s,e),t.single_file&&$("#"+t.browse_bnt_id).hide(),m(t.onAddItem,s,e),s}function v(e,n){if(n.width){var r=function(){var e="图片尺寸不合适!建议尺寸:<br>";e+=i("宽度",t.min_width,t.max_width,"px"),e+=i("高度",t.min_height,t.max_height,"px"),e+=i("高宽比",t.min_rate,t.max_rate),DlgOk(e,n.real_name+"("+n.width+"x"+n.height+"px)"),$("#"+t.browse_bnt_id).click()},i=function(e,t,n,r){return r=r||"",t>0&&n>0?"- "+e+"应在["+t+r+","+n+r+"]之间<br>":t>0?"- "+e+"应大于等于"+t+r+"<br>":n>0?"- "+e+"应小于等于"+n+r+"<br>":""},o=n.height/n.width;if(t.min_width>0&&t.min_width>n.width)return r();if(t.min_height>0&&t.min_height>n.height)return r();if(t.max_width>0&&t.max_width<n.width)return r();if(t.max_height>0&&t.max_height<n.height)return r();if(t.min_rate>0&&t.min_rate>o)return r();if(t.max_rate>0&&t.max_rate<o)return r()}e.find("[rel_input]").each(function(){var e=$(this),t=e.attr("rel_input");typeof n[t]!="undefined"&&$(this).val(n[t])}),e.find("[rel_item]").each(function(){var e=$(this),t=e.attr("rel_item"),r=e.attr("rel_key");typeof n[t]!="undefined"&&(r?$(this).attr(r,n[t]):$(this).html(n[t]))}),n.real_name&&e.find(".item-name").text(n.real_name),n.size&&e.find(".item-size").text(n.size),n.ksize&&e.find(".item-ksize").text(n.ksize);if(!n.file_name)return;var u=n.url?n.url:s+n.file_name;e.find(".item-link").attr("src",u),e.find(".item-enity").attr("src",u),e.find(".item-thumb").attr("src",n.thumb||u),e.find(".img_show").css("background-image","url("+(n.thumb||u)+")")}function m(e){if(typeof e!="function")return;return e.apply(this,[].splice.call(arguments,1))}var n,r,i="";t=$.extend({max_file_size:"1024mb",chunk_size:"0mb",browse_bnt_id:"",container:"",drop_bnt_id:"",target_dir:"/kf/uploader_manager/get_token",save_key:!1,unique_names:!0},t),"min_width,max_width,min_height,max_height,min_rate,max_rate".split(",").map(function(e){t[e]=Number(t[e])||0}),t.browse_bnt_id||(t.browse_bnt_id="bnt_"+e.attr("id")),t.container||(t.container=t.browse_bnt_id+"_container");var s="http://imgcdn.nowapp.cn/",o=$("#"+t.browse_bnt_id),u=0;if($("#"+t.browse_bnt_id).length<1){DlgOk("上传空间按钮设置错误!"),e.hide();return}f();var a=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:t.browse_bnt_id,container:t.container,drop_element:t.drop_bnt_id,max_file_size:t.max_file_size,flash_swf_url:"js/plupload/Moxie.swf",dragdrop:!1,chunk_size:t.chunk_size,uptoken_url:t.target_dir,domain:s,unique_names:t.unique_names,save_key:t.save_key,auto_start:!0,init:{FilesAdded:function(e,n){var r=function(e,n){n.my_st++;if(m(t.onAdd,e,n)===!1)return;n.item.removeClass("up-st-add").addClass("up-st-ing"),l(n.item,0)};for(var i=0;i<n.length;i++)n[i].my_st==1&&r.call(this,e,n[i])},BeforeUpload:function(e,n){if(m(t.onBeforeUpload,e,n)===!1)return;p(e,n)},UploadProgress:function(e,n){if(m(t.onUploadProgress,e,n)===!1)return;l(n.item,n.percent=="100"?99:n.percent)},UploadComplete:function(e,n){var r=function(e,r){delete r.my_st;if(m(t.onUploadComplete,e,n)===!1)return;l(r.item,100)};for(var i=0;i<n.length;i++)n[i].my_st&&r.call(this,e,n[i])},FileUploaded:function(e,n,r){var i=JSON.parse(r),s=!1,o,u={fid:n.id,size:n.size,ksize:n.ksize,minetype:n.type,filetype:"",ext:Qiniu.getFileExtension(i.key),md5:i.hash,file_name:i.key,real_name:n.name};n.type.indexOf("image/")===0&&(o=Qiniu.imageInfo(i.key))?(u.width=o.width,u.height=o.height,u.filetype="image",s=!0):n.type.indexOf("video/")===0&&(o=Qiniu.avInfo(i.key))&&(u.width=o.width,u.height=o.height,u.duration=o.duration,u.filetype="video"),ajax("/kf/uploader_manager/save_up_info",u,"get","json");if(m(t.onFileUploaded,e,n,r)===!1)return;n.item.removeClass("up-st-ing").addClass("up-st-finish");var a=$.extend({hash:u.md5,url:Qiniu.getUrl(u.file_name)},u);a.filetype=="image"&&(a.thumb=a.url+"_websmall"),v(n.item,a)},Error:function(e,n,r){if(m(t.onFileUploaded,e,n,r)===!1)return;r&&DlgOk(r,n)}}});e.on("click",".item-del",function(e){cancelEvt(e);var n=$(this).parents(".item_entity:eq(0)"),r=a.getFile(n.attr("id"));if(m(t.onRemoveItem,n,r)===!1)return;r&&r.destroy(),n.remove(),t.single_file&&$("#"+t.browse_bnt_id).show()}),a.bind("FileUploaded",function(){})}function showMobile(e){function r(){var t=i(e.id),n=$("#"+t);return n.length<1&&(n=$('<div class="mobile_shape"><div class="screen-body"></div><a href="#" class="bnt_home"></a></div>').appendTo(document.body),n.attr("id",t),e.cla&&n.addClass(e.cla),n.on("click",".screen-body a",function(e){cancelEvt(e)}),n.find(".bnt_home").click(function(e){cancelEvt(e),u()})),n}function i(e){return"mobile_"+e}function s(e){if(typeof e!="function")return;self=this==window?t:this;var r=[].splice.call(arguments,1);return r.unshift(n),e.call(self,r)}function o(t){if(s(e.beforeShow)===!1)return;n.slideDown(function(){a(t),s(e.afterShow)})}function u(t){if(s(e.close,t)===!1)return;n.removeData("ctrl"),n.slideUp(function(){n.remove(),s(e.destroy)})}function a(r){var i=n.find(".screen-body").html(r).get(0);if(s.call(i,e.showMsg,t)===!1)return;f.call(i)}function f(){var e=$(this),t=e.innerWidth(),n=e.innerHeight();$(this).find("img").load(function(){l(this,t,n)})}function l(e,t,n){var r=e.width,i=e.height;if(r<0||i<0)return;var s=e.parentNode,o=s.nodeName=="A"?s:document.createElement("span");try{e.insertAdjacentElement("afterend",o)}catch(o){}o.className="img_link";if(r>=t){var u=i/r;o.style.width=t+"px",o.style.height=t*u+"px"}else o.style.width=r+"px",o.style.height=i+"px";o.appendChild(e)}var t={};e=$.extend({id:"default_mobile"},e);var n=r();return n.data("ctrl",t),t.show=o,t.showMsg=a,t.close=u,t}function selectToSelect2(e,t,n){function o(t){return $("#"+e.attr("id")+" option[value='"+t+"']").remove().change()}function u(t,n){return e.append("<option value='"+t+"' selected>"+n+"</option>").change()}e.hide();var r="input_"+(e.attr("id")||""+(new Date).getTime()+"_"+(Math.random()*999|0)),i=$("<input id='"+r+"' />").insertAfter(e);t.multiple||(t.multiple=e.attr("multiple")=="multiple"),n||(n=[],e.find("option").each(function(){this.selected&&n.push({id:this.value,text:this.text})}));var s=i.select2(t).on("select2-selecting",function(e){return u(e.choice.id,e.choice.text)}).on("select2-removed",function(e){return o(e.choice.id)});return n&&n.length>0&&(t.multiple?(s.select2("data",n),n.map(function(e){u(e.id,e.text)})):(s.select2("data",n[0]),u(n[0].id,n[0].text))),e.data("s2",$("#s2id_"+r).data("select2")),$("#s2id_"+r).data("select2").init=function(e){},s}function reset_select_input(e,t,n){function u(e){if(s&&callFunction.call(r,s,e)===!1)return e;var t,n,i,u,a;e.list&&e.list instanceof Array&&(e=e.list);for(t=i=0,u=e.length;i<u;t=++i){n=e[t];if(o&&callFunction.call(r,o,n,t,e)===!1)continue;a=n.content||n.message||n.description||n.abstract;if(!n.text)if(n.title)n.text=n.title;else if(n.name!=null)n.text=n.name;else if(n.ectitle!=null)n.text=n.ectitle;else if(a){n.text=a.substr(0,20);continue}a&&(n.text+=" - "+a.substr(0,10))}return e}var r=e.get(0),i={placeholder:e.attr("placeholder")||"请输入关键字查询",width:e.attr("width")||380,minimumInputLength:Number(e.attr("min_len")||1)||1,ajax:{url:t,type:e.attr("method")||"get",data:function(e,t){return{search:e,per_page:200}},results:function(e,t){return{results:u(e)}}},dropdownCssClass:"bigdrop",escapeMarkup:function(e){return e}},s=e.attr("data_format")||!1,o=e.attr("row_format")||!1;return s&&(s=ucfirst(s,"f")),o&&(o=ucfirst
(o,"f")),selectToSelect2(e,i,u(n))}function bingding_drag_action(e,t){function r(e){var t=e.data("shadow"),n=getRect(e.get(0));t.css({left:n.left+"px",top:n.top+"px",width:n.width+"px",height:n.height+"px"})}function i(e,t){if(!t)return;return e.x>=t.left&&e.x<=t.left+t.width&&e.y>=t.top&&e.y<=t.top+t.height}var n=$(document);t=$.extend({speed:500},t),n.on("mousedown",e,function(s){function c(){var e=o.clone().hide().insertBefore(o),t=$("<div></div>").appendTo(document.body);return t.empty().css({position:"absolute",left:u.left+"px",top:u.top+"px",width:u.width+"px",height:u.height+"px",border:"1px dashed red","z-index":9999}),o.data("old_position",e),o.data("shadow",t),t=t.clone().appendTo(document.body),t.css({background:"#ccc",opacity:.3}),o.data("drag_shadow",t),t}function h(t){if(t.keyCode!=27)return;l=!1,$(e).each(function(){var e=$(this),t=e.data("old_position");t&&v(o,t.get(0),!1)}),m()}function p(e){var n=u.left+e.clientX,r=u.top+e.clientY;a.css({left:n+"px",top:r+"px"}),f&&clearTimeout(f),f=setTimeout(function(){f=0,d({x:n+a.width()/2,y:r+a.height()/2})},t.speed)}function d(n){var s=!0,u=$(e),a=!1;u.each(function(){if(this==o.get(0)){s=!1;return}if(i(n,getRect(this)))return v(o,this,s),l=!0,a=!0,!1});if(a)return;t.item_boxs&&$(t.item_boxs).each(function(){var e=$(this);if(e.find(o).length>0)return;if(i(n,getRect(this)))return callFunction.call(o.get(0),t.onMoveIn,this)!==!1&&o.appendTo(e),r(o),l=!0,!1})}function v(e,n,i){callFunction.call(e.get(0),t.onMoveTo,n,i)!==!1&&(i?e.insertBefore(n):e.insertAfter(n)),r(e)}function m(){if(!document.is_draging)return;f&&(clearTimeout(f),f=0),delete document.is_draging,n.unbind("mouseup.jay_drag"),n.unbind("mousemove.jay_drag"),n.unbind("selectstart.jay_drag"),n.unbind("keyup.jay_drag");var e=["shadow","drag_shadow","old_position"].map(function(e){var t=o.data(e);t.remove(),o.removeData(e)});callFunction.call(o.get(0),t.onMoveEnd,l)}if(document.is_draging)return;var o=$(this);if(callFunction.call(o.get(0),t.onBeforeMove,s)===!1)return;var u=getRect(o),a=c();document.is_draging=!0;var f=0,l=!1;u.left-=s.clientX,u.top-=s.clientY,n.bind("selectstart.jay_drag",function(e){cancelEvt(e)}),n.bind("mouseup.jay_drag",m),n.bind("mousemove.jay_drag",p),n.bind("keyup.jay_drag",h),callFunction.call(o.get(0),t.onMoveStart,s)})}function callFunction(e){type=typeof e,type=="string"&&(this[e]?e=this[e]:window[e]&&(e=window[e]));if(typeof e!="function")return;var t=[].slice.call(arguments,1);return e.apply(this,t)}function getZuixiaoGonbeishu(e,t){function i(e,t,n){return n+n>=e?e*t:t%n==0&&e%n==0?n*i(e/n,t/n,2):i(e,t,n+1)}e=parseInt(e)||0,t=parseInt(t)||0;var n=Math.min(e,t),r=Math.max(e,t);return n<=1?r:r%n==0?r:i(n,r,2)}function getTbInfo(e){function d(e){var t=e.html(),n=t.replace(/<br\s*\/?>/g,"lrln");return n=e.html(n).text(),e.html(t),n.replace(/\s+/g," ").replace(/lrln/g,"\n").replace(/\n{2,}/g,"\n").trim()}var t=0,n,r=[],i=0,s=0,o=0,u=function(e,t){return t=t||5,e<1&&(e=t),Math.round(e/t)*t},a=function(e){e.r=1};$("#tmp_tb_info").remove();var f=$('<div id="tmp_tb_info"></div>').css({height:"1100px",width:document.body.offsetWidth+"px",overflow:"hidden"}).appendTo(document.body);e=e.clone().appendTo(f),e.removeAttr("class").css({width:"auto"}),e.find(".print_none").remove(),e.find(".tmp_tb").remove(),e.find("td").each(function(){var e=$(this),t=e.attr("rowspan"),n=e.attr("colspan");s=Math.max(s,$(this).innerHeight()),o=Math.max(o,$(this).innerWidth())}).each(function(){this.height=s,this.width=o}),e.find("tr").each(function(e){$(this).find("td,th").each(function(){var e=$(this),u=e.offset();r.push(n={t:d(e),x:Math.round((u.left-t)/o),y:i,c:Math.round(e.innerWidth()/o),r:Math.round(e.innerHeight()/s)||1})}),i++});var l=100,c=0,h=0,p=[];return $(r).each(function(){h!=this.y&&(l>1&&l==c&&p.map(a),l=100,c=0,h=this.y,p=[]),l=Math.min(l,this.r),c=Math.max(c,this.r),p.push(this)}),f.remove(),r}function onResetPerPage(e){var t=$(this).prev("input"),n=t.val();if(!n)return;n=Number(n)||0;if(n<1)return;var r=MyURL.url2obj(location.href,!0);r.params.per_page=n,r.params.page=1;var i=MyURL.obj2url(r);location=i}function onBtnPrint(e,t){function r(){var e=n.find("canvas").each(function(){var e=$(this);e.next("img.canvas_shadow").remove(),e.addClass("print_none");var t=this.toDataURL("image/png");$("<img >").addClass("canvas_shadow hidden print").attr("src",t).insertAfter(this)});if(n.length>1){var t=$("<div></div>");n.each(function(){$(this).clone().appendTo(t)}),n=t}n.print()}function i(){ajax("/assets/jQuery.print.js?body=1",{},"get","html",function(e,t){if(t)return;var n=new Function(e);n(),r()})}var n=$(t||$(this).attr("area"));if(n.length<1){DlgOk("打印对象不存在!");return}if(!n.print){i();return}r()}function onBtnExport2excel(e,t){var n=$(this),r=$(t||n.attr("area"));if(r.length<1){DlgOk("目标对象不存在!");return}var i=r.find(".subject").length>0&&r.find(".subject").text()||n.attr("subject")||n.parent("[subject]")&&n.parent("[subject]").attr("subject")||document.title||"",s=[],o={},u=0,a;r.each(function(){var e=$(this);this.nodeName!="TABLE"&&(e=e.parents("table:eq(0)"));var t=getTbInfo(e);u=s.length,u>0&&(u++,s.push([{colspan:1,rowspan:1,content:""}])),t.map(function(e){a=e.y+u,o[a]||(o[a]=[],s.push(o[a])),o[a].push({colspan:1,rowspan:e.r,content:e.t})})}),window.debug_table2exel&&console.log("print_data",s);if(s.length<1)return DlgOk("导出失败!可能原因是无法识别到任何数据记录"),!1;jform=mkForm("/kf/tools/to_xls",{data:s,title:i},{method:"post"})}function getIfrm(e){e=e||"win_default";var t=$('iframe[name="'+e+'"]');return t.length<1&&(t=$('<iframe height=0 width=0 name="'+e+'"></iframe>').appendTo(document.body)),t}function mkForm(e,t,n){function f(e,t){if(t instanceof Array)for(var n=0,r=e+"[]";n<t.length;n++)t[n]instanceof Array?f(e+"["+n+"]",t[n]):f(r,t[n]);else if(typeof t=="object")for(var n in t)f(e+"["+n+"]",t[n]);else u+='<input type=hidden name="'+e+'" value="'+t+'">'}n=$.extend({method:"get"},n);var r="t_"+(new Date).getTime(),i=null;ajax("/kf/tools/to_xls",{url:e},"get","html",{async:!1},function(e,t){i=$(e).appendTo(document.body)});if(!i)return;var s={width:"1px",height:"1px",overflow:"hidden"};i.attr({method:n.method,target:r,ignore_check:1}).css(s);if(n.is_hide!==!1){var o=getIfrm(r);o.get(0).onload=function(){n.cb&&typeof n.cb=="function"&&n.cb.call(this),i.remove(),o.remove()}}var u="<div>";for(var a in t)f(a,t[a]);return u+="</div>",$(u).appendTo(i),i.submit(),i}function onBtnExportProData(e){function n(e){if(e.length<1){location=t;return}var n=e[0].subject,i="已经存在的历史报表:<br>";i+="《"+n+"》<br>";for(var s=0;s<e.length;s++)i+='<a href="#" itemid="'+e[s].id+'" class="btn">'+(s+1)+". "+e[s].time+"</a>&nbsp;";i+='<a href="#" itemid="0">+更新</a><br>',Dlg(i,{title:"选择下载",bind:{"a[itemid]":r}})}function r(e){var n=$(this);location=t+"&log_id="+n.attr("itemid")||0}var t=this.href;ajax(t,{},"get","json",function(e,t){if(e&&e.list)return n(e.list);DlgOk("系统繁忙,请稍后再试!")})}function onBtnSendQaNotice(e){ajax(this.href,{},"post","json",function(e,t){t?DlgOk(e&&e.msg||"系统繁忙,请稍后再试!","推送失败"):DlgOk(e.msg,function(){})})}function onBtnAwardCredit(e,t,n,r){DlgWaitting(),ajax(r||"/question/tools/award_credit",{id:t,uid:n},"post","json",function(e,r){DlgWaitting("close"),e&&e.error_code?DlgOk("操作失败!原因为:<br>"+e.msg,e.title+"("+e.error_code+")"):r?DlgOk("操作失败!原因为:网络繁忙,请稍后再试"):(n=="all"&&local_store.set("credit_"+t,!0,"5h"),DlgOk(e.msg||"操作成功!",e.title,function(){var t=0,n=0,r;if(e.data)for(var i in e.data)t++,r=$("[credit_info="+i+"]").html(e.data[i]),r.length>0&&n++;t!==n&&location.reload()}))})}function onBtnWinClose(e){window.close&&window.close()}function show_page(e,t){function u(e){if(callFunction.call(r.get(0),t.close,e)===!1)return;o||(getDlgBg("close"),o=!0),a()}function a(){r.find(".body").css({opacity:.9}),i.opacity=0,r.animate(i,function(){r.remove()})}function f(){var n=r.find(">.body");callFunction.call(r.get(0),t.before_show,t)===!1&&a(),typeof e=="object"?$(e).appendTo(n.empty()):n.html(e),t.url&&r.load(),initMultiSel(n),t.bind=t.bind||t.clicks;var i,s,o;if(t.bind&&typeof t.bind=="object")for(s in t.bind)o=t.bind[s],i=s.split("::",2),s=i.pop(),i=i.pop()||"click",n.on(i,s,l(o));callFunction.call(r.get(0),t.after_show,t)}function l(e){return function(t){cancelEvt(t);var n=!0;typeof e=="function"&&(n=e.call(this,r));if(n===!1)return;u(n)}}!t&&e&&typeof e=="object"&&(t=e,e=""),t=$.extend({},t);var n='<div class=page_item><div class="body"></div></div>',r=$(n).appendTo(document.body),i={"margin-right":"-"+r.outerWidth()+"px"},s={"margin-right":0},o=!1;return t.cla&&r.addClass(t.cla),t.show_bg===1?getDlgBg("show",function(){o=!0,u()}):t.show_bg&&getDlgBg("show"),r.css(i).animate(s,f),t.close_btn!==!1&&$('<a href="#" class="close">关闭</a>').appendTo(r).click(function(e){cancelEvt(e),u()}),r.close=u,r.load=function(e,n,r){var i="访问失败!",r=(r||t.dtype||"json").toUpperCase();ajax(e||t.url,{},n||t.method||"get",r,{async:!1},function(e,t){r=="JSON"?(!e.html&&e.msg&&(e.html="<h1>"+e.title+"</h1>"+e.msg),e&&e.html&&(i=e.html)):e&&!t&&(i=e)}),this.find(">.body").html(i)},r.on("close",function(e,t){u(t)}),r}String.prototype.is_email=function(){return/^[a-z0-9\-_]+@[a-z0-9\-_]+\.[a-z0-9\-_]+$/i.test(this)},String.prototype.wlen=function(){return this.replace(/[x000-x0ff]/g,"**").length},String.prototype.is_token=function(){return/^[\w]+$/i.test(this)},String.prototype.is_number=function(){return/^\-?[1-9][0-9]*\.?[0-9]*$|^-?0\.[0-9]{0,9}$|^0$/.test(this)},String.prototype.is_mobile=function(){return/^1[2-9][0-9]{9,9}$/.test(this)},$(function(){function e(){$("[memo]").each(function(){var e=$(this),t=e.attr("memo");t&&(t=$('<span class="text-memo"></span>').html(t),e.hasClass("form-control")?t.appendTo(e.parent().parent()):e.parent().hasClass("controls")?t.appendTo(e.parent()):t.insertAfter(e))})}function t(e){e.keyCode==13||e.keyCode==188||e.keyCode==186?$(this).next("a").click():e.keyCode==32&&this.value.charCodeAt(this.value.length-1)==32&&$(this).next("a").click()}function n(e){if($(this).attr("mthd"))return;cancelEvt(e),$(this).parent().remove()}function r(e){cancelEvt(e);var t=$(this).prev("input"),n=t.get(0);if(!n)return;var r=n.value.replace(/[,;\s]/g,"");if(n.value.length<1)return;var i=!1;t.parent().parent().find(".tag input").each(function(){return i=this.value==r,!i});if(i)return;n.value="";var s=$('<span class="tag">'+r+'<input type="hidden" name="'+t.attr("n")+'" value="'+r+'"><a href="#" class="btn_rm">x</a></span>');s.insertBefore(t.parent())}function i(e){var t="mthd",n="on";if(e.type=="change")t="chg";else if(e.type=="mouseover"||e.type=="mouseout")t="ftips",n="showTips";var r=$(this),i=r.attr(t),s=r.attr("param");if(r.data("click")){cancelEvt(e);return}e.type=="click"&&(r.data("click",1),setTimeout(function(){r.removeData("click")},1e3)),!i&&t=="ftips"&&(i="default");if(!i||r.attr("disabled")||r.hasClass("disabled"))return!1;var o=window.Mthds||window,u=[];r.attr("nsp")&&u.push(r.attr("nsp")),r.parents("[nsp]").each(function(){var e=$(this);e.attr("nsp")&&u.push(e.attr("nsp"))}),u.push("Mthds");var a=[];i=ucfirst(i,n),s&&(a=s.split(",")),a.unshift(e);try{var f,l;while(u.length>0){l=ucfirst(u.shift());if(window[l]&&typeof window[l]=="object"&&typeof window[l][i]=="function"){f=window[l][i];break}}f||(f=window[i]);if(f&&f.apply&&f.apply(this,a)===!0)return!0;t=="mthd"&&(a.shift(),a={args:a,mthd:i},r.trigger("mthd_"+i,a),r.trigger("mthd",a))}catch(c){window.console&&console.error(c.stack)}cancelEvt(e)}if(window._tools_init)return;window._tools_init=!0,$(".control-group.tags input[n],[nobr]").keypress(function(e){return e.keyCode!=13}),$(document).on("submit","form[ajax]",onAjaxRequest).on("click","form .bnt_submit",function(){$(this).parents("form").submit()}).on("click","form .bnt_reset",function(){var e=$(this).parents("form");jfrom.length>0&&jfrom.get(0).onreset()}).on("click","a[ajax]",onAjaxRequest).on("click","[mthd]",i).on("change","[chg]",i).on("mouseover","[tips],[ftips]",i).on("mouseout","[tips],[ftips]",i).on("click",".tags_bar a.btn_rm,.control-group.tags a.btn_rm",n).on("click",".form-group.tags a.btn_add",r).on("keyup",".form-group.tags input[n]",t),initTemplateFields(),bindJQLoadingEvent(),initAttachmentUploader(),initMultiSel(),init_btn_group(),window.Qiniu&&QiniuVideoExt(Qiniu.constructor),$.fn.datetimepicker&&initDomForTimeInput(),setTimeout(e,1e3)}),$(function(){}),function(e){function o(e,n){var r=this;this.id=e,this.Api={},t[this.id]=this,n=n||l(this.id),typeof n=="function"&&(this.main=n)}function u(e,t){window.console&&console.error(e+":("+(t||1)+")")}function a(e,t){var n=c(e,t);return f(n)}function f(e){var r;t[e]||new o(e);var i=t[e];if(r=i.main){delete i.main;try{r.call(i,i.Api,function(e){return a(e,i.id)},i,e,n)}catch(s){u(s.message+"At:"+i.id)}}return i.Api}function l(e){var t=null,n=e;return!i||(e.indexOf("?")==-1?n+="?_"+i:n+="&_"+i),ajax(n,{},"get","html",{async:!1},function(n,r){try{if(r)throw Error(r);n&&(t=new Function("Api","require","_model","__PATH__","_global",(n||"")+";return Api;"))}catch(i){u(i.message+" At:"+e)}}),t}function c(e,t){var n=t.split("/");n.pop();var r=e.split("/");return r[0]==""&&(n=[""]),r.map(function(e){e=e.trim(),e!="."&&e!=""&&(e==".."?n.pop():n.push(e))}),n.join("/")}var t={},n={},r=!1,i=($('script[src*="/tools-"]').attr("src")||"").split("-").pop().split(".").shift(),s="/assets/";$(function(){r=!0;for(var e in t)f(e)}),e.require=function(e){return a(e,s)},e.app=function(e,t){var n=new o(c(e,s),t);return r&&f(n.id),this},o.prototype.require=function(e){return a(e,this.id)}};